{% extends "base.html" %}
{% block title %}代理池管理面板 - 帮助{% endblock %}

{% block content %}
<div class="page-header mb-4 fade-in">
    <h1>
        <i class="bi bi-question-circle"></i> API 使用指南
    </h1>
    <p class="text-muted">了解如何正确使用 ProxyPool API</p>
</div>

<!-- 简介 -->
<div class="card mb-4 fade-in">
    <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0"><i class="bi bi-info-circle"></i> 基本信息</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>基础地址:</strong></p>
                <code class="bg-light p-2 d-block">http://{{ api_host }}:{{ api_port }}</code>
            </div>
            <div class="col-md-6">
                <p><strong>支持开发语言:</strong></p>
                <p>Python, JavaScript, PHP, Java, Go, Shell</p>
            </div>
        </div>
    </div>
</div>

<!-- API 接口定义 -->
<div class="card mb-4 fade-in">
    <div class="card-header bg-success text-white">
        <h5 class="card-title mb-0"><i class="bi bi-list-ul"></i> API 接口定义</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>接口</th>
                        <th>描述</th>
                        <th>返回类型</th>
                        <th>示例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>GET /random</code></td>
                        <td>获取随机代理</td>
                        <td>文本 - IP:PORT</td>
                        <td><code>127.0.0.1:8080</code></td>
                    </tr>
                    <tr>
                        <td><code>GET /all</code></td>
                        <td>获取所有代理</td>
                        <td>文本 - 每行一个</td>
                        <td><code>127.0.0.1:8080<br>127.0.0.2:8080</code></td>
                    </tr>
                    <tr>
                        <td><code>GET /count</code></td>
                        <td>获取代理总数</td>
                        <td>整数</td>
                        <td><code>100</code></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 查询参数 -->
<div class="card mb-4 fade-in">
    <div class="card-header bg-info text-white">
        <h5 class="card-title mb-0"><i class="bi bi-sliders"></i> 查询参数</h5>
    </div>
    <div class="card-body">
        <p>所有 API 接口都支持子池代理指定，例如:</p>
        <div class="alert alert-light border">
            <p><strong>子池代理 (特定业务需求):</strong></p>
            <code class="bg-light p-2 d-block">GET /random?key=xxx</code>
            <p class="mt-2 mb-0"><small class="text-muted">其中 xxx 是自定义的 Redis key 名称，用于区分不同的代理池</small></p>
        </div>
    </div>
</div>

<!-- 使用示例 -->
<div class="card fade-in">
    <div class="card-header bg-warning text-dark">
        <h5 class="card-title mb-0"><i class="bi bi-code-square"></i> 各语言使用示例</h5>
    </div>
    <div class="card-body">
        <ul class="nav nav-tabs" id="languageTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="python-tab" data-bs-toggle="tab" data-bs-target="#python" type="button" role="tab">
                    <i class="bi bi-file-earmark-code"></i> Python
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="javascript-tab" data-bs-toggle="tab" data-bs-target="#javascript" type="button" role="tab">
                    <i class="bi bi-file-earmark-code"></i> JavaScript
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="php-tab" data-bs-toggle="tab" data-bs-target="#php" type="button" role="tab">
                    <i class="bi bi-file-earmark-code"></i> PHP
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="java-tab" data-bs-toggle="tab" data-bs-target="#java" type="button" role="tab">
                    <i class="bi bi-file-earmark-code"></i> Java
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="go-tab" data-bs-toggle="tab" data-bs-target="#go" type="button" role="tab">
                    <i class="bi bi-file-earmark-code"></i> Go
                </button>
            </li>
        </ul>
        <div class="tab-content mt-3" id="languageTabsContent">
            <div class="tab-pane fade show active" id="python" role="tabpanel">
                <pre><code class="language-python">import requests

def get_proxy():
    proxy_url = 'http://{{ api_host }}:{{ api_port }}/random'
    try:
        response = requests.get(proxy_url)
        if response.status_code == 200:
            return response.text
    except requests.exceptions.ConnectionError:
        return None

def use_proxy(proxy, target_url):
    proxies = {
        'http': 'http://' + proxy,
        'https': 'https://' + proxy,
    }
    try:
        response = requests.get(target_url, proxies=proxies, timeout=10)
        return response
    except:
        return None

if __name__ == '__main__':
    proxy = get_proxy()
    if proxy:
        print('获取到代理:', proxy)
        response = use_proxy(proxy, 'http://httpbin.org/ip')
        if response:
            print('代理可用:', response.text)
    else:
        print('未获取到代理')</code></pre>
            </div>
            <div class="tab-pane fade" id="javascript" role="tabpanel">
                <pre><code class="language-javascript">const axios = require('axios');

async function getProxy() {
    try {
        const response = await axios.get('http://{{ api_host }}:{{ api_port }}/random');
        return response.data;
    } catch (error) {
        console.error('获取代理失败:', error);
        return null;
    }
}

async function useProxy(proxy, targetUrl) {
    try {
        const response = await axios.get(targetUrl, {
            proxy: {
                host: proxy.split(':')[0],
                port: parseInt(proxy.split(':')[1])
            },
            timeout: 10000
        });
        return response.data;
    } catch (error) {
        console.error('使用代理失败:', error);
        return null;
    }
}

getProxy().then(proxy => {
    if (proxy) console.log('代理:', proxy);
});</code></pre>
            </div>
            <div class="tab-pane fade" id="php" role="tabpanel">
                <pre><code class="language-php">&lt;?php
function getProxy() {
    $proxyUrl = 'http://{{ api_host }}:{{ api_port }}/random';
    try {
        return file_get_contents($proxyUrl);
    } catch (Exception $e) {
        return null;
    }
}

function useProxy($proxy, $targetUrl) {
    $context = stream_context_create([
        'http' => [
            'proxy' => 'tcp://' . $proxy,
            'request_fulluri' => true,
            'timeout' => 10,
        ],
    ]);
    try {
        return file_get_contents($targetUrl, false, $context);
    } catch (Exception $e) {
        return null;
    }
}

$proxy = getProxy();
if ($proxy) {
    echo "代理: " . $proxy;
} else {
    echo "获取失败";
}
?&gt;</code></pre>
            </div>
            <div class="tab-pane fade" id="java" role="tabpanel">
                <pre><code class="language-java">import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class ProxyPool {
    public static String getProxy() {
        try {
            URL url = new URL("http://{{ api_host }}:{{ api_port }}/random");
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setRequestMethod("GET");
            
            if (conn.getResponseCode() == 200) {
                BufferedReader in = new BufferedReader(
                    new InputStreamReader(conn.getInputStream()));
                String line;
                StringBuilder result = new StringBuilder();
                while ((line = in.readLine()) != null) {
                    result.append(line);
                }
                in.close();
                return result.toString();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
    
    public static void main(String[] args) {
        String proxy = getProxy();
        if (proxy != null) {
            System.out.println("代理: " + proxy);
        }
    }
}</code></pre>
            </div>
            <div class="tab-pane fade" id="go" role="tabpanel">
                <pre><code class="language-go">package main

import (
    "fmt"
    "io/ioutil"
    "net/http"
)

func getProxy() (string, error) {
    resp, err := http.Get("http://{{ api_host }}:{{ api_port }}/random")
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()
    
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        return "", err
    }
    return string(body), nil
}

func main() {
    proxy, err := getProxy()
    if err == nil {
        fmt.Println("代理:", proxy)
    }
}</code></pre>
            </div>
        </div>
    </div>
</div>

{% endblock %}
